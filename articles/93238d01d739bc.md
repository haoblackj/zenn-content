---
title: "AutoHotkeyに雑用を食わせるイロハ"
emoji: "👌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AutoHotkey","Tech","小説"]
published: false
---
# 但し書き
この記事に提示しているサンプルスクリプトは、すべて動作未確認となります。
あらかじめご了承ください。

# 要点
- AutoHotkey にやらせているアレコレ
  - 括弧・ショートコード入力
  - Google 検索・DeepL 翻訳・JapanKnowledge 検索

# 括弧・ショートコード入力
「選択した文字列をクリップボードにコピーし、その前後を引数で挟んで返す」関数を用意した。
クリップボードへの登録は、AutoHotkey に Ctrl+C を押下させている。
Ctrl+C 後にクリップボードが 0 文字だったら(=無選択だったら)単に引数を返して、カーソルをひとつ前に送る。
Ctrl+C 後、クリップボード内に改行が入っていたら、上記と同様の処理を行う。
最後にクリップボードを処理前の状態に戻して、終了だ。

```ahk:WrapBracket.ahk
WrapBracket(x,y){
  Backup := ClipboardAll
  Clipboard =
  Send, ^c
  Sleep,50
  IfInString, Clipboard, `r`n
  {
    Clipboard =
    ClipStatus := 0 ;中身が空文字列なので0
  }Else if (Clipboard = ""){
    ClipStatus := 0
  }else{
    ClipStatus := 1 ;中身があるので1
    #if
  }
  Sleep,50
  Clipboard = %x%%Clipboard%%y%
  Sleep, 50
  Send,^v
  Sleep,50
  if (ClipStatus = 0){
    send,{Left}
  }Else{
    #If
  }
  Clipboard := Backup
  ClipStatus =
}
```

関数の呼び出し方は以下のとおり。
キーをひとつ、または&を挟むことでふたつ以上の同時押しを指定できる。

```ahk:AutoHotkey.ahk
sc07B & k::
WrapBracket("「","」")
Return
```
ちなみに、「sc07B」とは無変換キーを示す文字列だ。
全角・半角キーなら「sc029」、変換キーなら「sc079」といった具合に指定する。
キーリストはこちら。
http://ahkwiki.net/KeyList

# Google 検索
AutoHotkey は簡易的な GUI を作成できる。
上記した括弧・ショートコード入力同様、ホットキーを指定して呼び出すこともできる。
Google 検索機能と後に紹介する DeepL 翻訳機能は、いずれもこの GUI を作成して実現した。

```ahk:Search.ahk
sc07B & l::
    stash := ClipboardAll
    Clipboard :=
    Send, ^c
    ClipWait, 0.5
    clip := Clipboard
    Clipboard := stash
    clip := rm_crlf(clip)
    Gui, Add, Text, , 日本語→英語
    Gui, Add, Text, , (Shift)英語→日本語
    Gui, Add, Edit, v_str_deepl w380 -WantReturn
    Gui, Add, Button, Default, Translate
    Gui, Show, Center w400, DeepL
    clip := ""
    Return
    ButtonTranslate:
      Gui, Submit
      ; Shift押下時はja->en
      If GetKeyState("Shift", "P") {
        Run, https://www.deepl.com/translator#ja/en/%_str_deepl%
      ; 直打ちならばen->ja
      } Else {
        Run, https://www.deepl.com/translator#en/ja/%_str_deepl%
      }
    GuiEscape:
      Gui, Destroy
    GuiClose:
      Gui, Destroy
  Return

sc07B & g::
    stash := ClipboardAll
    Clipboard :=
    Send, ^c
    ClipWait, 0.5
    clip := Clipboard
    Clipboard := stash
    If clip !=
      IfNotInString, clip, `r`n
      {
        Run, https://www.google.co.jp/search?q=%clip%
        clip := ""
        IfWinActive, Chrome
        {
          return
        }else{
          WinActivate, Chrome
        }
        Return
      }
    Gui, Add, Edit, v_str_google w380 -WantReturn
    Gui, Add, Button, Default, Search
    Gui, Show, Center w400, Google
    Send, {vkF2}
    clip := ""
    Return
    ButtonSearch:
      Gui, Submit
      Run, https://www.google.co.jp/search?q=%_str_google%
    2GuiEscape:
      Gui, Destroy
    2GuiClose:
      Gui, Destroy
  Return

  ; 2:JapanKnowledge検索
sc07B & j::
    stash := ClipboardAll
    Clipboard :=
    Send, ^c
    ClipWait, 0.05
    clip := Clipboard
    Clipboard := stash
    If clip !=
    IfNotInString, clip, `r`n
      {
        Run, https://japanknowledge.com/psnl/search/basic/?q1=%clip%
        clip := ""
        IfWinActive, Chrome
        {
          return
        }else{
          WinActivate, Chrome
        }
        Return
        }
    Gui, Add, Edit, v_str_japanknowledge w380 -WantReturn
    Gui, Add, Button, Default, JKSearch
    Gui, Show, Center w400, JapanKnowledge
    Send, {vkF2}
    clip := ""
    Return
    ButtonJKSearch:
      Gui, Submit
      Run, https://japanknowledge.com/psnl/search/basic/?q1=%_str_japanknowledge%
    3GuiEscape:
      Gui, Destroy
    3GuiClose:
      Gui, Destroy
  Return

```
やっていることは、括弧・ショートコード入力と大差ない。
選択文字列があれば Ctrl+C を押下し、クリップボードから文字列を取得し、検索用 URL へ変数として埋め込む。
選択文字列がなければ GUI を起動し、入力し Submit された文字列を取得し、検索用 URL へ変数として埋め込む。

サニタイジングが面倒なので、改行コードや記号が選択文字列にあれば無視して、GUI を起動するようにしている。

# 今後の展望
この記事は「入門編」だ。
当然、後方にはいろいろな記事が控えている。

職場やネカフェで執筆するのに必須、Windows の機能と絡めた『ボスが来た』機能実装のアレコレだとか。
AutoHotkey はアイデア次第でいくらでも便利にできるので飽きない。

興味が湧いたという物好きな人はここから AutoHotkey を落としてインストールしよう。
https://www.autohotkey.com/
共に世界の支配構造を打ち砕こうではないか。